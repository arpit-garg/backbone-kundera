<!DOCTYPE html>
<html>
<head>
	<title>I have a back bone</title>
</head>
<body>
	<div>	
	<button id="view-books">View</button>
	</div>
	<div>
	<button id="display">Display</button>
	</div>
	<ul id="friends-list">
	</ul>
	<script type="text/javascript" src="lib/jquery.js"></script>
	<script type="text/javascript" src="lib/underscore.js"></script>
	<script type="text/javascript" src="lib/backbone.js"></script>
	<script type="text/javascript" src="js/kundera.js"></script>
	<script>
	(function ($) {		
		Friend = Backbone.Model.extend({
			
			name: null
		});

		Friends = Backbone.Collection.extend({
			
			initialize: function (models, options) {
				this.bind("add", options.view.addFriendLi);
			}
		});

		AppView = Backbone.View.extend({
			el: $("body"),
			initialize: function () {
				this.friends = new Friends( null, {view: this });
			},
			events: {
				//alert("before initialize");
				"click #view-books": "initialise",
				"click #display": "showPrompt",
			},
			showPrompt: function () {
				var friend_name = prompt("who is your friend?");
				var friend_model = new Friend({ name: friend_name });
				this.friends.add( friend_model );
			},

			addFriendLi: function (model) {
				
				$("#friends-list").append("<li>" + model.get('name') + "</li>");
			},
		
			
			initialise : function() {
		        alert("inside initialise");
				Persistence.createEntityManagerFactory("twissandra", null, "selectQueryE",
		                        "showPrompt");
				alert("after initialise");

			}



      		/*	selectQueryE : function() {
				alert("inside selectQuery");
				em.createQuery("select * from Book", null,"selectSuccess","selectFailure");
				alert("inside selectQuery");
			},

		    selectSuccess :function(resp){
		     	 console.log(resp);
		     
			},


			selectFailure :function(resp){
		     	 console.log(resp);
		     
			}  */

		});

		

		var appview = new AppView;

	})(jQuery);
	
	var obj = {};

	function selectQueryE(resp) {
			alert("inside selectQuery");
			em.createQuery("select b from Book b", null,"selectSuccess","selectFailure");
			alert("inside selectQuery");
			}

    		function selectSuccess(resp){
         	 console.log(resp);
		 obj = Kundera.fromJSONObject(resp);
         	 console.log(obj);
		showPrompt(obj)
		}


		function selectFailure(resp){
         	 console.log(resp);
		}

		function showPrompt(obj) {
				var array = obj["book"];
				var html = "<table><th>Author</th><th>ISBN</th><th>Publication</th>";
				for (var i in array){
					//html += "<table>";
					html += "<tr><td>" + array[i]["author"] + "</td><td>" + array[i]["isbn"] + "</td><td>" + 							array[i]["publication"] + "</td></tr>" 
				
					 	
					//document.write(array[i]["author"]);
					//document.write(array[i]["isbn"]);
					//document.write(array[i]["publication"]);
					
				}
				//document.write(obj);
			//	for(var i in obj){
			//	}
			//	var friend_name = prompt("who is your friend?");
			//	var friend_model = new Friend({ name: friend_name });
			//	Backbone.View.addFriendLi(friend_model);
				//this.friends.add( friend_model );
		html += "</html>"
		document.getElementById("data").innerHTML = html;		

		} 

/*var html = "<ol>";
for (var i in keyspacesArray){
    html += "<li><h4>";
    html += "<a href='http://localhost:8080/KDataViewerHTMLOnly/columnfamilies.jsp?dbname=" + keyspacesArray[i]["keyspace_name"] + " '> " + keyspacesArray[i]["keyspace_name"] + "</a></h4></li>";

}
html += "</ol>";
document.getElementById("keyspace_data").innerHTML = html; */





</script>
<div id ="data"></div>
</body>
</html>




    
